# Pre-Release Verification Checklist

Use this checklist before merging "Version Packages" PRs.

## 🔍 Build & Test

- [ ] `pnpm install` completes without errors
- [ ] `pnpm build` succeeds for all packages
- [ ] `pnpm typecheck` passes
- [ ] `pnpm lint` passes
- [ ] All Turbo cache hits work correctly

## 📦 Package Verification

### @commet/node (SDK)

- [ ] Dry run publish succeeds: `cd packages/node && pnpm publish --dry-run`
- [ ] Package size is reasonable (<25 KB tarball)
- [ ] All exports are present in `dist/`
- [ ] TypeScript declarations generated
- [ ] Both CJS and ESM formats present

### commet (CLI)

- [ ] Dry run publish succeeds: `cd packages/cli && pnpm publish --dry-run`
- [ ] CLI executable works: `commet --version`
- [ ] All commands available: `commet --help`
- [ ] Bin file is executable

## 📝 Documentation

- [ ] README.md updated with correct versions
- [ ] CHANGELOG.md generated by Changesets
- [ ] Package READMEs are up to date
- [ ] Migration guide exists if breaking changes

## 🔐 Security

- [ ] No secrets in code
- [ ] `publishConfig.provenance: true` in both packages
- [ ] No dev dependencies in production builds
- [ ] Dependencies are up to date (or known issues documented)

## 🚀 Release Notes

- [ ] Changesets describe changes accurately
- [ ] Breaking changes are clearly marked
- [ ] Migration instructions provided if needed
- [ ] Version bumps are appropriate (major/minor/patch)

## ✅ Final Checks

- [ ] Git status is clean
- [ ] All changes committed
- [ ] Branch is up to date with main
- [ ] CI/CD passes on GitHub

## After Merge

- [ ] Verify npm publish succeeded
- [ ] Check package pages on npm:
  - https://www.npmjs.com/package/@commet/node
  - https://www.npmjs.com/package/commet
- [ ] Test installation: `npm install @commet/node` and `npm install -g commet`
- [ ] Verify provenance on npm package page
- [ ] Update documentation site if needed
- [ ] Announce release if major version

## Emergency Rollback

If something goes wrong:

```bash
# Unpublish within 72 hours (use sparingly)
npm unpublish @commet/node@VERSION
npm unpublish commet@VERSION

# Or deprecate
npm deprecate @commet/node@VERSION "Reason for deprecation"
npm deprecate commet@VERSION "Reason for deprecation"
```

## Quick Commands

```bash
# Full verification
pnpm install && pnpm build && pnpm typecheck && pnpm lint

# Test both packages
cd packages/node && pnpm publish --dry-run && cd ../cli && pnpm publish --dry-run

# Test CLI
npm link && commet --version && commet --help
```

