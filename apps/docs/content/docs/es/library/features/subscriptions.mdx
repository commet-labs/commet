---
title: Suscripciones
description: Gestiona suscripciones con el modelo plan-first
---

## Crear Suscripción

```typescript
const subscription = await commet.subscriptions.create({
  externalId: 'user_123',
  planId: 'plan_pro'
})
```

### Opciones

| Parámetro | Tipo | Descripción |
|-----------|------|-------------|
| `externalId` o `customerId` | string | Identificador del cliente (requerido) |
| `planId` | string | Plan a suscribir (requerido) |
| `billingInterval` | string | `monthly`, `quarterly`, o `yearly` |
| `initialSeats` | object | Cantidad inicial de seats por tipo |
| `skipTrial` | boolean | Saltar el período de trial si el plan tiene |
| `startDate` | string | Fecha ISO para suscripción futura |

## Obtener Suscripción

Cada cliente tiene una suscripción activa. Esto la retorna con resumen completo:

```typescript
const sub = await commet.subscriptions.get({
  externalId: 'user_123'
})

if (sub.data) {
  console.log('Plan:', sub.data.plan.name)
  console.log('Estado:', sub.data.status)
  console.log('Días restantes:', sub.data.currentPeriod.daysRemaining)
  
  for (const feature of sub.data.features) {
    if (feature.usage) {
      console.log(`${feature.name}: ${feature.usage.current}/${feature.usage.included}`)
    }
  }
}
```

## Cambiar Plan

```typescript
await commet.subscriptions.changePlan('sub_xxx', {
  planId: 'plan_enterprise'
})
```

Proration automático: Commet calcula crédito por tiempo no usado y cobra el nuevo plan.

## Cancelar

```typescript
await commet.subscriptions.cancel('sub_xxx', {
  reason: 'switched_to_competitor'
})
```

## Estados de Suscripción

| Estado | Descripción |
|--------|-------------|
| `draft` | Creada pero no activada |
| `pending_payment` | Esperando primer pago |
| `trialing` | En período de trial |
| `active` | Activa y facturando normalmente |
| `paused` | Pausada temporalmente |
| `past_due` | Pago falló, período de gracia |
| `canceled` | Cancelada |
| `expired` | Llegó a fecha de fin |

## Períodos de Trial

Si un plan tiene días de trial, las nuevas suscripciones inician en estado `trialing`:

```typescript
const subscription = await commet.subscriptions.create({
  externalId: 'user_123',
  planId: 'plan_with_trial'
})

console.log(subscription.data.status)  // "trialing"
console.log(subscription.data.trialEndsAt)

// Saltar trial si es necesario
await commet.subscriptions.create({
  externalId: 'user_456',
  planId: 'plan_with_trial',
  skipTrial: true
})
```

## Ejemplo Completo

```typescript
import { Commet } from '@commet/node'

const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'sandbox'
})

// 1. Suscribir a un plan
const sub = await commet.subscriptions.create({
  externalId: 'user_123',
  planId: 'plan_pro',
  initialSeats: { editor: 5 }
})

// 2. Trackear uso
await commet.usage.track({
  externalId: 'user_123',
  eventType: 'api_call',
  idempotencyKey: `evt_${Date.now()}`
})

// 3. Agregar más seats
await commet.seats.add({
  externalId: 'user_123',
  seatType: 'editor',
  count: 3
})

// 4. Verificar estado actual
const current = await commet.subscriptions.get({ externalId: 'user_123' })
console.log('Días restantes:', current.data?.currentPeriod.daysRemaining)

// 5. Upgrade de plan
await commet.subscriptions.changePlan(sub.data.id, {
  planId: 'plan_enterprise'
})
```

## Recursos Relacionados

- [Planes](/es/docs/library/features/plans) - Listar planes disponibles
- [Eventos de Uso](/es/docs/library/features/usage-events) - Trackear consumo
- [Seats](/es/docs/library/features/seat-management) - Gestionar licencias
