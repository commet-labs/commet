---
title: Suscripciones
description: Crea y gestiona suscripciones con la API ultra-simple
---

# Suscripciones

La API de suscripciones de Commet proporciona una forma ultra-simple de crear suscripciones. Solo pasa un `productId` y `customerId`, y el sistema maneja automáticamente los precios, cantidades y configuración según tu producto.

## ¿Por Qué Suscripciones Simples?

- **2 campos requeridos** en lugar de 10+ parámetros complejos
- **Defaults inteligentes** basados en la configuración del producto
- **Funciona para todos los tipos**: facturación fija, por uso y por asientos
- **Facturación automática** - genera facturas inmediatamente al activarse

## Inicio Rápido

```typescript
import { Commet } from '@commet/node';

const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'production'
});

// Crear suscripción - ¡así de fácil!
const subscription = await commet.subscriptions.create({
  productId: 'prod_enterprise_plan',
  customerId: 'cus_acme'
});
```

## Cómo Funciona

Cuando creas una suscripción, el backend:

1. **Encuentra el precio de lista por defecto** del producto (o el primero disponible)
2. **Detecta el tipo de producto** del `quantitySource`:
   - `fixed` - Productos de cantidad fija (licencias, planes)
   - `usage_metric` - Basado en consumo (llamadas API, emails)
   - `seat_balance` - Licencias por asiento (cuentas de usuario)
3. **Auto-configura todo**:
   - Cantidades y métricas
   - Día de facturación (hoy o fecha de inicio personalizada)
   - Estructura de fases (invisible para ti)
   - Generación de factura (si el estado es activo)

## Tipos de Productos

### Productos de Cantidad Fija

Productos con cantidad fija como Planes Enterprise, licencias únicas, etc.

```typescript
// Usar cantidad por defecto (1)
await commet.subscriptions.create({
  productId: 'prod_enterprise_plan',
  customerId: 'cus_acme'
});

// O especificar cantidad personalizada
await commet.subscriptions.create({
  productId: 'prod_api_platform',
  externalId: 'my-customer-123',
  quantity: 5 // 5 unidades
});
```

**Backend configura**: `fixedQuantity = 1` (o tu cantidad especificada)

### Productos Basados en Uso

Productos donde la cantidad viene de eventos de uso (llamadas API, emails enviados, etc).

```typescript
// Crear suscripción
await commet.subscriptions.create({
  productId: 'prod_api_calls',
  customerId: 'cus_startup'
});

// Luego enviar eventos de uso
await commet.usage.create({
  eventType: 'api_call',
  customerId: 'cus_startup',
  timestamp: new Date().toISOString()
});
```

**Backend configura**: Usa el `usageMetricId` del precio de lista del producto. No necesita `quantity` - viene de los eventos.

### Productos Basados en Asientos

Productos facturados por asiento/usuario/licencia.

```typescript
// Empezar con asientos iniciales
await commet.subscriptions.create({
  productId: 'prod_saas_licenses',
  customerId: 'cus_tech_company',
  initialSeats: 10 // Empezar con 10 asientos
});

// Agregar asientos después
await commet.seats.add({
  customerId: 'cus_tech_company',
  seatType: 'editor',
  count: 5
});
```

**Backend configura**: Usa el `seatTypeId` del precio de lista del producto. `initialSeats` por defecto es 0 si no se especifica.

## Referencia API

### Crear Suscripción

```typescript
await commet.subscriptions.create(params);
```

**Parámetros Requeridos**:
- `productId` (string) - UUID del producto
- `customerId` (string) O `externalId` (string) - Identificador del cliente

**Parámetros Opcionales**:
- `name` (string) - Nombre de la suscripción. Por defecto: `"Subscription for [Nombre Cliente]"`
- `startDate` (string) - Fecha ISO. Por defecto: ahora
- `status` ("draft" | "active") - Por defecto: `"active"` (genera factura inmediatamente)
- `quantity` (number) - Para productos fijos. Por defecto: 1
- `initialSeats` (number) - Para productos por asientos. Por defecto: 0

**Auto-calculado**:
- `billingDayOfMonth` - Tomado de la fecha actual o `startDate`
- Estructura de fases - Auto-generada "Phase 1"

**Respuesta**:
```typescript
{
  success: true,
  message: "Subscription created successfully",
  data: {
    id: "sub_abc123", // publicId
    customerId: "cus_xxx",
    productId: "prod_xxx",
    name: "Subscription for Acme Corp",
    status: "active",
    startDate: "2025-11-04T00:00:00Z",
    endDate: "2125-11-04T00:00:00Z",
    billingDayOfMonth: 4,
    createdAt: "2025-11-04T10:30:00Z",
    updatedAt: "2025-11-04T10:30:00Z"
  }
}
```

### Listar Suscripciones

```typescript
await commet.subscriptions.list({
  customerId: 'cus_xxx',
  status: 'active'
});
```

**Parámetros**:
- `customerId` (string) - Filtrar por ID de cliente
- `externalId` (string) - Filtrar por ID externo
- `status` ("draft" | "active" | "completed" | "canceled") - Filtrar por estado

### Obtener Suscripción

```typescript
await commet.subscriptions.retrieve('sub_abc123');
```

### Cancelar Suscripción

```typescript
await commet.subscriptions.cancel('sub_abc123');
```

## Ejemplos Completos

### Plataforma SaaS (Por Asientos)

```typescript
// Crear suscripción con asientos
const sub = await commet.subscriptions.create({
  productId: 'prod_saas_platform',
  externalId: 'startup-xyz',
  initialSeats: 5,
  name: 'Startup XYZ - Plan Growth',
  status: 'active'
});

// Usuario agrega miembros del equipo
await commet.seats.add({
  externalId: 'startup-xyz',
  seatType: 'editor',
  count: 3
});

// Verificar asientos actuales
const balance = await commet.seats.getBalance({
  externalId: 'startup-xyz',
  seatType: 'editor'
});
console.log(balance.data.current); // 8 (5 iniciales + 3 agregados)
```

### Plataforma API (Por Uso)

```typescript
// Crear suscripción
await commet.subscriptions.create({
  productId: 'prod_api_platform',
  customerId: 'cus_fintech_app'
});

// Rastrear uso de API
await commet.usage.createBatch({
  events: [
    {
      eventType: 'api_call',
      customerId: 'cus_fintech_app',
      timestamp: new Date().toISOString(),
      properties: [
        { property: 'endpoint', value: '/api/transactions' },
        { property: 'method', value: 'POST' }
      ]
    },
    // ... más eventos
  ]
});
```

### Enterprise (Fijo + Revisión Draft)

```typescript
// Crear como draft para revisión de ventas
const draft = await commet.subscriptions.create({
  productId: 'prod_enterprise',
  customerId: 'cus_big_corp',
  quantity: 10,
  name: 'Big Corp - Deal Enterprise Personalizado',
  status: 'draft' // No facturar todavía
});

// Revisar en UI, luego activar manualmente
// (o vía API cuando sea aprobado)
```

## Manejo de Errores

```typescript
try {
  await commet.subscriptions.create({
    productId: 'prod_xxx',
    customerId: 'cus_xxx'
  });
} catch (error) {
  if (error.statusCode === 404) {
    console.error('Producto o cliente no encontrado');
  } else if (error.statusCode === 400) {
    console.error('Producto no tiene precios de lista configurados');
  }
}
```

## Mejores Prácticas

1. **Usa `externalId`** si tienes tus propios IDs de cliente - es más simple
2. **Por defecto usa `status: "active"`** a menos que necesites aprobación manual
3. **Deja que el backend auto-configure** - no sobre-pienses los quantity sources
4. **Para asientos, empieza con 0** y agrega asientos mientras los usuarios se registran
5. **Para uso, crea la suscripción primero** luego rastrea eventos por separado

## Próximos Pasos

- [Eventos de Uso](/docs/es/usage) - Rastrea consumo para facturación por uso
- [Gestión de Asientos](/docs/es/seats) - Gestiona licencias por asiento
- [Clientes](/docs/es/customers) - Crea y gestiona clientes

