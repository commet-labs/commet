---
title: Configuración Node.js
description: Usa Commet SDK en cualquier proyecto Node.js o TypeScript
---

import { Steps, Step } from 'fumadocs-ui/components/steps'
import { Tabs, Tab } from 'fumadocs-ui/components/tabs'
import { Callout } from 'fumadocs-ui/components/callout'

# Configuración Node.js & TypeScript

Usa Commet SDK en cualquier proyecto Node.js: Express, Fastify, funciones serverless, o scripts.

<Callout type="info">
**Requisitos:** Node.js 18.0+
</Callout>

<Steps>
<Step>

## Instalar

<Tabs items={['npm', 'pnpm', 'yarn', 'bun']}>
<Tab value="npm">
```bash
npm install @commet/node
```
</Tab>
<Tab value="pnpm">
```bash
pnpm add @commet/node
```
</Tab>
<Tab value="yarn">
```bash
yarn add @commet/node
```
</Tab>
<Tab value="bun">
```bash
bun add @commet/node
```
</Tab>
</Tabs>

</Step>

<Step>

## Configurar

```bash title=".env"
COMMET_API_KEY=tu_clave_api_aqui
COMMET_ENV=sandbox
```

</Step>

<Step>

## Inicializar

```typescript title="lib/commet.ts"
import { Commet } from '@commet/node'

export const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'sandbox', // o 'production'
})
```

</Step>

<Step>

## Usar

```typescript
// Rastrear uso
await commet.usage.create({
  eventType: 'api_call',
  customerId: 'cus_xxx',
  idempotencyKey: `evt_${Date.now()}`,
})

// Crear cliente
const customer = await commet.customers.create({
  legalName: 'Acme Corp',
  billingEmail: 'billing@acme.com',
  address: {
    line1: '123 Main St',
    city: 'San Francisco',
    postalCode: '94102',
    country: 'US',
  },
})

// Crear suscripción
const subscription = await commet.subscriptions.create({
  customerId: customer.data.id,
  items: [
    { priceId: 'price_xxx', quantity: 1 }
  ],
})
```

</Step>
</Steps>

## Ejemplos por Framework

### Express

```typescript title="src/server.ts"
import express from 'express'
import { commet } from './lib/commet'

const app = express()
app.use(express.json())

app.post('/api/usage', async (req, res) => {
  const { eventType, customerId } = req.body
  
  const result = await commet.usage.create({
    eventType,
    customerId,
    idempotencyKey: `${customerId}_${Date.now()}`,
  })
  
  res.json(result.data)
})

app.listen(3000)
```

### Fastify

```typescript title="src/server.ts"
import Fastify from 'fastify'
import { commet } from './lib/commet'

const fastify = Fastify()

fastify.post('/api/usage', async (request, reply) => {
  const { eventType, customerId } = request.body
  
  const result = await commet.usage.create({
    eventType,
    customerId,
    idempotencyKey: `${customerId}_${Date.now()}`,
  })
  
  return result.data
})

fastify.listen({ port: 3000 })
```

### Serverless

<Tabs items={['Vercel', 'AWS Lambda']}>
<Tab value="Vercel">
```typescript title="api/usage.ts"
import type { VercelRequest, VercelResponse } from '@vercel/node'
import { Commet } from '@commet/node'

const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
})

export default async function handler(req: VercelRequest, res: VercelResponse) {
  const { eventType, customerId } = req.body
  
  const result = await commet.usage.create({
    eventType,
    customerId,
    idempotencyKey: `${customerId}_${Date.now()}`,
  })
  
  res.json(result.data)
}
```
</Tab>
<Tab value="AWS Lambda">
```typescript title="functions/usage.ts"
import { APIGatewayProxyEvent, APIGatewayProxyResult } from 'aws-lambda'
import { Commet } from '@commet/node'

const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
})

export const handler = async (event: APIGatewayProxyEvent): Promise<APIGatewayProxyResult> => {
  const { eventType, customerId } = JSON.parse(event.body || '{}')
  
  const result = await commet.usage.create({
    eventType,
    customerId,
    idempotencyKey: `${customerId}_${Date.now()}`,
  })
  
  return {
    statusCode: 200,
    body: JSON.stringify(result.data),
  }
}
```
</Tab>
</Tabs>

## Manejo de Errores

```typescript
import { CommetAPIError } from '@commet/node'

try {
  await commet.usage.create({
    eventType: 'api_call',
    customerId: 'cus_xxx',
    idempotencyKey: 'unique_key',
  })
} catch (error) {
  if (error instanceof CommetAPIError) {
    console.error('Error de API:', error.statusCode, error.message)
  }
}
```

## Mejores Prácticas

### Siempre Usa Claves de Idempotencia

```typescript
// ✅ Bueno
await commet.usage.create({
  eventType: 'api_call',
  customerId: 'cus_xxx',
  idempotencyKey: `${customerId}_${requestId}`,
})

// ❌ Malo - puede crear duplicados
await commet.usage.create({
  eventType: 'api_call',
  customerId: 'cus_xxx',
})
```

### Rastreo Sin Bloquear

```typescript
// ✅ Bueno - no bloquea la petición
commet.usage.create({
  eventType: 'api_call',
  customerId: 'cus_xxx',
  idempotencyKey: 'unique_key',
}).catch(console.error)

// Continúa procesando...

// ❌ Malo - bloquea la petición
await commet.usage.create({
  eventType: 'api_call',
  customerId: 'cus_xxx',
  idempotencyKey: 'unique_key',
})
```

### Operaciones por Lotes

```typescript
const events = Array.from({ length: 100 }, (_, i) => ({
  eventType: 'api_call',
  customerId: 'cus_xxx',
  idempotencyKey: `batch_${Date.now()}_${i}`,
}))

const result = await commet.usage.createBatch({ events })
```

## Recursos Relacionados

- [Testing](/es/docs/library/core/testing) - Prueba con entorno sandbox
- [Manejo de Errores](/es/docs/library/core/error-handling) - Maneja errores correctamente
