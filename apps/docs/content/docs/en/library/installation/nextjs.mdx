---
title: Next.js Setup
description: Use Commet SDK in Next.js applications
---

import { Steps, Step } from 'fumadocs-ui/components/steps'
import { Tabs, Tab } from 'fumadocs-ui/components/tabs'

<Steps>
<Step>

## Install

<Tabs items={['pnpm', 'npm', 'yarn', 'bun']}>
<Tab value="pnpm">
```bash
pnpm add @commet/node @commet/next
```
</Tab>
<Tab value="npm">
```bash
npm install @commet/node @commet/next
```
</Tab>
<Tab value="yarn">
```bash
yarn add @commet/node @commet/next
```
</Tab>
<Tab value="bun">
```bash
bun add @commet/node @commet/next
```
</Tab>
</Tabs>

</Step>

<Step>

## Configure

```bash title=".env.local"
COMMET_API_KEY=ck_sandbox_xxx
COMMET_WEBHOOK_SECRET=whsec_xxx
```

</Step>

<Step>

## Initialize

```typescript title="lib/commet.ts"
import { Commet } from '@commet/node'

export const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'sandbox',
})
```

</Step>

<Step>

## Create Subscription

```typescript title="app/actions/billing.ts"
'use server'

import { redirect } from 'next/navigation'
import { commet } from '@/lib/commet'

export async function subscribe(externalId: string) {
  await commet.customers.create({
    email: 'user@example.com',
    externalId,
  })

  const subscription = await commet.subscriptions.create({
    externalId,
    planCode: 'pro',
  })

  redirect(subscription.data.checkoutUrl!)
}
```

</Step>

<Step>

## Handle Payment

```typescript title="app/api/webhooks/commet/route.ts"
import { Webhooks } from '@commet/next'

export const POST = Webhooks({
  webhookSecret: process.env.COMMET_WEBHOOK_SECRET!,
  onSubscriptionActivated: async (payload) => {
    // Grant access to payload.data.externalId
  },
})
```

</Step>

<Step>

## Check Access

```typescript
const subscription = await commet.subscriptions.get({ externalId: 'user_123' })

if (subscription.data?.status === 'active') {
  // User has paid
}
```

</Step>
</Steps>

## Customer Portal

```typescript title="app/api/commet/portal/route.ts"
import { CustomerPortal } from '@commet/next'

export const GET = CustomerPortal({
  apiKey: process.env.COMMET_API_KEY!,
  getCustomerId: async (req) => {
    // Return user's externalId from your auth
    return 'user_123'
  },
})
```

```tsx
<a href="/api/commet/portal">Manage Billing</a>
```

## Related

- [Node.js Setup](/docs/library/installation/node)
- [Webhooks](/docs/library/features/webhooks)
- [Customer Portal](/docs/library/features/portal-access)
