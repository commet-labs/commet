---
title: Subscriptions
description: Manage subscriptions with the plan-first model
---

import { Tabs, Tab } from 'fumadocs-ui/components/tabs'
import { Callout } from 'fumadocs-ui/components/callout'

<Callout type="info">
**Plan-First Model:** Each customer can only have ONE active subscription at a time.
This simplifies billing and makes it easy to know exactly what plan a customer is on.
</Callout>

## Create Subscription

Subscribe a customer to a plan:

```typescript
const subscription = await commet.subscriptions.create({
  externalId: 'user_123',  // Your user ID
  planId: 'plan_pro',
  billingInterval: 'yearly',  // optional, defaults to plan's default
  initialSeats: { editor: 5 }  // optional
})

console.log('Subscription created:', subscription.data.id)
```

### Options

| Parameter | Type | Description |
|-----------|------|-------------|
| `externalId` or `customerId` | string | Customer identifier (required) |
| `planId` | string | Plan to subscribe to (required) |
| `billingInterval` | string | `monthly`, `quarterly`, or `yearly` |
| `initialSeats` | object | Initial seat counts by type |
| `skipTrial` | boolean | Skip the trial period if plan has one |
| `startDate` | string | ISO date for future-dated subscription |
| `name` | string | Custom subscription name |

## Get Active Subscription

Since each customer has only one active subscription:

```typescript
const sub = await commet.subscriptions.get({
  externalId: 'user_123'
})

if (sub.data) {
  console.log('Current plan:', sub.data.plan.name)
  console.log('Status:', sub.data.status)
} else {
  console.log('No active subscription')
}
```

## Change Plan

Upgrade or downgrade a subscription:

```typescript
await commet.subscriptions.changePlan('sub_xxx', {
  planId: 'plan_enterprise',
  billingInterval: 'yearly',
  prorate: true  // Calculate credits/charges for partial period
})
```

<Callout type="success">
**Proration:** When `prorate: true`, Commet calculates the credit for unused time
on the old plan and the charge for the remaining time on the new plan.
</Callout>

## Pause and Resume

Temporarily pause a subscription:

```typescript
// Pause
await commet.subscriptions.pause('sub_xxx', {
  reason: 'seasonal'
})

// Resume later
await commet.subscriptions.resume('sub_xxx')
```

<Callout type="info">
Paused subscriptions don't generate invoices. Usage and seat events are still tracked.
</Callout>

## Get Billing Summary

View the current period's usage, seats, and estimated total:

```typescript
const summary = await commet.subscriptions.getSummary('sub_xxx')

console.log('Plan:', summary.data.plan.name)
console.log('Base price:', summary.data.plan.basePrice)
console.log('Estimated total:', summary.data.estimatedTotal)
console.log('Days remaining:', summary.data.currentPeriod.daysRemaining)

// Check feature usage
for (const feature of summary.data.features) {
  if (feature.usage) {
    console.log(`${feature.name}: ${feature.usage.current}/${feature.usage.included}`)
  }
}
```

## Cancel Subscription

```typescript
await commet.subscriptions.cancel('sub_xxx', {
  reason: 'switched_to_competitor'
})
```

## Subscription Status

| Status | Description |
|--------|-------------|
| `draft` | Created but not activated |
| `pending_payment` | Waiting for first payment |
| `trialing` | In trial period (if plan has trial) |
| `active` | Active and billing normally |
| `paused` | Temporarily paused |
| `past_due` | Payment failed, grace period |
| `canceled` | Canceled, no longer billing |
| `expired` | Reached end date |

## Trial Periods

If a plan has trial days configured, new subscriptions start in `trialing` status:

```typescript
// Plan with 14-day trial
const subscription = await commet.subscriptions.create({
  externalId: 'user_123',
  planId: 'plan_with_trial'
})

console.log(subscription.data.status)  // "trialing"
console.log(subscription.data.trialEndsAt)  // ISO date

// Skip trial if needed
const noTrial = await commet.subscriptions.create({
  externalId: 'user_456',
  planId: 'plan_with_trial',
  skipTrial: true
})
```

## List Subscriptions

```typescript
// List all subscriptions for a customer
const subscriptions = await commet.subscriptions.list({
  externalId: 'user_123'
})

// Filter by status
const canceled = await commet.subscriptions.list({
  externalId: 'user_123',
  status: 'canceled'
})
```

## Complete Example

```typescript
import { Commet } from '@commet/node'

const commet = new Commet({
  apiKey: process.env.COMMET_API_KEY!,
  environment: 'sandbox'
})

// 1. Subscribe to a plan
const sub = await commet.subscriptions.create({
  externalId: 'user_123',
  planId: 'plan_pro',
  billingInterval: 'yearly',
  initialSeats: { editor: 5 }
})

// 2. Track usage
await commet.usage.track({
  externalId: 'user_123',
  eventType: 'api_call',
  idempotencyKey: `evt_${Date.now()}`
})

// 3. Add more seats
await commet.seats.add({
  externalId: 'user_123',
  seatType: 'editor',
  count: 3
})

// 4. Check summary
const summary = await commet.subscriptions.getSummary(sub.data.id)
console.log('Estimated total:', summary.data.estimatedTotal)

// 5. Upgrade plan
await commet.subscriptions.changePlan(sub.data.id, {
  planId: 'plan_enterprise',
  prorate: true
})
```

## Related Resources

- [Plans](/docs/library/features/plans) - List available plans
- [Usage Events](/docs/library/features/usage-events) - Track consumption
- [Seat Management](/docs/library/features/seat-management) - Manage licenses
- [Portal Access](/docs/library/features/portal-access) - Customer self-service
